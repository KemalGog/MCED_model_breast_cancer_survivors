anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet)
}, error = function(e) return(NULL))
if (is.null(df)) next
colnames(df) <- tolower(trimws(colnames(df)))
if (!all(c("stage", "age", "rate") %in% colnames(df))) next
# Clean and filter data
df <- df %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
# Compute stage weights
stage_weights <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop") %>%
mutate(weight = total_rate / sum(total_rate))
# Compute weighted average sensitivities
early_stages <- c("I", "II")
late_stages  <- c("III", "IV")
early_sens <- sum(stage_weights$weight[stage_weights$stage %in% early_stages] *
sens[stage_weights$stage[stage_weights$stage %in% early_stages]])
late_sens <- sum(stage_weights$weight[stage_weights$stage %in% late_stages] *
sens[stage_weights$stage[stage_weights$stage %in% late_stages]])
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
print(results)
library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) {
# Map of internal cancer names to Excel sheet names
cancer_sheet_map <- c(
anus = "Anus, Anal Canal And Anorectum",
bladder = "Urinary Bladder",
cervix = "Cervix Uteri",
colorectal = "Colon and Rectum",
esophagus = "Esophagus",
head = "Head and Neck",
kidney = "Kidney and Renal Pelvis",
liver = "Liver",
lung = "Lung and Bronchus",
lymphoma = "Non-Hodgkins Lymphoma",
melanoma = "Melanoma of the Skin",
ovary = "Ovary",
pancreas = "Pancreas",
stomach = "Stomach",
thyroid = "Thyroid",
uterus = "Corpus and Uterus, NOS"
)
# Galleri test sensitivity by stage (Table S5)
galleri_sens <- list(
anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet)
}, error = function(e) return(NULL))
if (is.null(df) || ncol(df) < 3) next
# Explicitly rename first 3 columns: stage, age, rate
colnames(df)[1:3] <- c("stage", "age", "rate")
# Clean and filter
df <- df %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
# Stage-specific weights from incidence rates
stage_weights <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop") %>%
mutate(weight = total_rate / sum(total_rate))
# Weighted averages
early_stages <- c("I", "II")
late_stages  <- c("III", "IV")
early_sens <- sum(stage_weights$weight[stage_weights$stage %in% early_stages] *
sens[stage_weights$stage[stage_weights$stage %in% early_stages]])
late_sens <- sum(stage_weights$weight[stage_weights$stage %in% late_stages] *
sens[stage_weights$stage[stage_weights$stage %in% late_stages]])
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
print(results)
library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) {
cancer_sheet_map <- c(
anus = "Anus, Anal Canal And Anorectum",
bladder = "Urinary Bladder",
cervix = "Cervix Uteri",
colorectal = "Colon and Rectum",
esophagus = "Esophagus",
head = "Head and Neck",
kidney = "Kidney and Renal Pelvis",
liver = "Liver",
lung = "Lung and Bronchus",
lymphoma = "Non-Hodgkins Lymphoma",
melanoma = "Melanoma of the Skin",
ovary = "Ovary",
pancreas = "Pancreas",
stomach = "Stomach",
thyroid = "Thyroid",
uterus = "Corpus and Uterus, NOS"
)
galleri_sens <- list(
anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet)
}, error = function(e) return(NULL))
if (is.null(df) || ncol(df) < 3) next
colnames(df)[1:3] <- c("stage", "age", "rate")
df <- df %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
stage_totals <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop")
I <- stage_totals$total_rate[stage_totals$stage == "I"]
II <- stage_totals$total_rate[stage_totals$stage == "II"]
III <- stage_totals$total_rate[stage_totals$stage == "III"]
IV <- stage_totals$total_rate[stage_totals$stage == "IV"]
early_num <- (I * sens["I"]) + (II * sens["II"])
early_den <- I + II
late_num  <- (III * sens["III"]) + (IV * sens["IV"])
late_den  <- III + IV
early_sens <- ifelse(early_den > 0, early_num / early_den, NA)
late_sens  <- ifelse(late_den > 0, late_num / late_den, NA)
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
print(results)
library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) {
cancer_sheet_map <- c(
anus = "Anus, Anal Canal And Anorectum",
bladder = "Urinary Bladder",
cervix = "Cervix Uteri",
colorectal = "Colon and Rectum",
esophagus = "Esophagus",
head = "Head and Neck",
kidney = "Kidney and Renal Pelvis",
liver = "Liver",
lung = "Lung and Bronchus",
lymphoma = "Non-Hodgkins Lymphoma",
melanoma = "Melanoma of the Skin",
ovary = "Ovary",
pancreas = "Pancreas",
stomach = "Stomach",
thyroid = "Thyroid",
uterus = "Corpus and Uterus, NOS"
)
galleri_sens <- list(
anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet, .name_repair = "minimal")
}, error = function(e) return(NULL))
if (is.null(df) || ncol(df) < 3) next
colnames(df)[1:3] <- c("stage", "age", "rate")
df <- df %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
stage_totals <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop")
I <- stage_totals$total_rate[stage_totals$stage == "I"]
II <- stage_totals$total_rate[stage_totals$stage == "II"]
III <- stage_totals$total_rate[stage_totals$stage == "III"]
IV <- stage_totals$total_rate[stage_totals$stage == "IV"]
early_num <- (I * sens["I"]) + (II * sens["II"])
early_den <- I + II
late_num  <- (III * sens["III"]) + (IV * sens["IV"])
late_den  <- III + IV
early_sens <- ifelse(early_den > 0, early_num / early_den, NA)
late_sens  <- ifelse(late_den > 0, late_num / late_den, NA)
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) {
cancer_sheet_map <- c(
anus = "Anus, Anal Canal And Anorectum",
bladder = "Urinary Bladder",
cervix = "Cervix Uteri",
colorectal = "Colon and Rectum",
esophagus = "Esophagus",
head = "Head and Neck",
kidney = "Kidney and Renal Pelvis",
liver = "Liver",
lung = "Lung and Bronchus",
lymphoma = "Non-Hodgkins Lymphoma",
melanoma = "Melanoma of the Skin",
ovary = "Ovary",
pancreas = "Pancreas",
stomach = "Stomach",
thyroid = "Thyroid",
uterus = "Corpus and Uterus, NOS"
)
galleri_sens <- list(
anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet, .name_repair = "minimal")
}, error = function(e) return(NULL))
if (is.null(df) || ncol(df) < 3) next
colnames(df)[1:3] <- c("stage", "age", "rate")
df <- df %>%
filter(!is.na(stage), !is.na(age)) %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
stage_totals <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop")
get_rate <- function(stage) {
val <- stage_totals$total_rate[stage_totals$stage == stage]
ifelse(length(val) == 0, 0, val)
}
I <- get_rate("I")
II <- get_rate("II")
III <- get_rate("III")
IV <- get_rate("IV")
early_num <- (I * sens["I"]) + (II * sens["II"])
early_den <- I + II
late_num  <- (III * sens["III"]) + (IV * sens["IV"])
late_den  <- III + IV
early_sens <- ifelse(early_den > 0, early_num / early_den, NA)
late_sens  <- ifelse(late_den > 0, late_num / late_den, NA)
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
library(readxl)
library(dplyr)
library(stringr)
compute_weighted_sensitivities <- function(file_path, age_min = 55, age_max = 74) {
cancer_sheet_map <- c(
anus = "Anus, Anal Canal And Anorectum",
bladder = "Urinary Bladder",
cervix = "Cervix Uteri",
colorectal = "Colon and Rectum",
esophagus = "Esophagus",
head = "Head and Neck",
kidney = "Kidney and Renal Pelvis",
liver = "Liver",
lung = "Lung and Bronchus",
lymphoma = "Non-Hodgkins Lymphoma",
melanoma = "Melanoma of the Skin",
ovary = "Ovary",
pancreas = "Pancreas",
stomach = "Stomach",
thyroid = "Thyroid",
uterus = "Corpus and Uterus, NOS"
)
galleri_sens <- list(
anus       = c(I = 0.25,   II = 0.75,   III = 1.00,   IV = 1.00),
bladder    = c(I = 0.1765, II = 0.1765, III = 0.75,   IV = 1.00),
cervix     = c(I = 0.5833, II = 1.00,   III = 1.00,   IV = 1.00),
colorectal = c(I = 0.4333, II = 0.85,   III = 0.8788, IV = 0.9531),
esophagus  = c(I = 0.125,  II = 0.6471, III = 0.9412, IV = 1.00),
head       = c(I = 0.6316, II = 0.8236, III = 0.8421, IV = 0.96),
kidney     = c(I = 0.0492, II = 0.1875, III = 0.1875, IV = 0.5455),
liver      = c(I = 0.8125, II = 0.8125, III = 1.00,   IV = 1.00),
lung       = c(I = 0.2188, II = 0.7955, III = 0.9068, IV = 0.9517),
lymphoma   = c(I = 0.2727, II = 0.5833, III = 0.7174, IV = 0.6087),
melanoma   = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 1.00),
ovary      = c(I = 0.5,    II = 0.8,    III = 0.871,  IV = 0.9474),
pancreas   = c(I = 0.6098, II = 0.6098, III = 0.8571, IV = 0.9589),
stomach    = c(I = 0.1667, II = 0.5,    III = 0.8,    IV = 1.00),
thyroid    = c(I = 0.00,   II = 0.00,   III = 0.00,   IV = 0.00),
uterus     = c(I = 0.1667, II = 0.3,    III = 0.7391, IV = 1.00)
)
results <- list()
for (cancer in names(cancer_sheet_map)) {
sheet <- cancer_sheet_map[[cancer]]
sens <- galleri_sens[[cancer]]
df <- tryCatch({
read_excel(file_path, sheet = sheet, .name_repair = "unique")
}, error = function(e) return(NULL))
if (is.null(df) || ncol(df) < 3) next
colnames(df)[1:3] <- c("stage", "age", "rate")
df <- df %>%
filter(!is.na(stage), !is.na(age)) %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+"))) %>%
filter(age_num >= age_min, age_num <= age_max) %>%
filter(stage %in% names(sens)) %>%
mutate(rate = as.numeric(rate)) %>%
filter(!is.na(rate))
stage_totals <- df %>%
group_by(stage) %>%
summarise(total_rate = sum(rate, na.rm = TRUE), .groups = "drop")
get_rate <- function(stage) {
val <- stage_totals$total_rate[stage_totals$stage == stage]
ifelse(length(val) == 0, 0, val)
}
I <- get_rate("I")
II <- get_rate("II")
III <- get_rate("III")
IV <- get_rate("IV")
early_num <- (I * sens["I"]) + (II * sens["II"])
early_den <- I + II
late_num  <- (III * sens["III"]) + (IV * sens["IV"])
late_den  <- III + IV
early_sens <- ifelse(early_den > 0, early_num / early_den, NA)
late_sens  <- ifelse(late_den > 0, late_num / late_den, NA)
results[[cancer]] <- data.frame(
Cancer = cancer,
Early_Sensitivity = round(early_sens, 4),
Late_Sensitivity = round(late_sens, 4)
)
}
bind_rows(results)
}
file_path <- "~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data/incidence_ajcc7_stages_1-4.xlsx"
results <- compute_weighted_sensitivities(file_path)
print(results)
library(readxl)
library(dplyr)
library(stringr)
# Load and clean data
df <- read_excel("incidence_ajcc7_stages_1-4.xlsx", sheet = "Colon and Rectum", .name_repair = "unique")
setwd("~/OneDrive - Fred Hutchinson Cancer Center/MCED Modeling for breast cancer survivors/Model breast cancer survivors/Data")
library(readxl)
library(dplyr)
library(stringr)
# Load and clean data
df <- read_excel("incidence_ajcc7_stages_1-4.xlsx", sheet = "Colon and Rectum", .name_repair = "unique")
colnames(df)[1:3] <- c("stage", "age", "rate")
# Clean and filter for age 55–74 and stages I–IV
df_clean <- df %>%
filter(str_detect(age, "years")) %>%
mutate(age_num = as.numeric(str_extract(age, "\\d+")),
rate = as.numeric(rate)) %>%
filter(age_num >= 55, age_num <= 74) %>%
filter(stage %in% c("I", "II", "III", "IV"))
# Sum incidence by stage
stage_totals <- df_clean %>%
group_by(stage) %>%
summarise(total = sum(rate, na.rm = TRUE), .groups = "drop")
# Define Galleri sensitivity for colorectal
sens <- c(I = 0.4333, II = 0.85, III = 0.8788, IV = 0.9531)
# Extract total incidence per stage
I <- stage_totals$total[stage_totals$stage == "I"]
II <- stage_totals$total[stage_totals$stage == "II"]
III <- stage_totals$total[stage_totals$stage == "III"]
IV <- stage_totals$total[stage_totals$stage == "IV"]
# Compute early (I+II) and late (III+IV) weighted sensitivities
early_sens <- (I * sens["I"] + II * sens["II"]) / (I + II)
late_sens  <- (III * sens["III"] + IV * sens["IV"]) / (III + IV)
# Print results
cat("Colorectal Cancer\n")
cat("Early-stage Sensitivity: ", round(early_sens, 4), "\n")
cat("Late-stage Sensitivity: ", round(late_sens, 4), "\n")
View(df)
View(df_clean)
View(stage_totals)
