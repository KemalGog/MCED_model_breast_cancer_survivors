"0","library(RobinCar)"
"2","Warning: package ‘RobinCar’ was built under R version 4.3.3"
"0","library(tidyverse)"
"2","Warning: package ‘ggplot2’ was built under R version 4.3.3"
"0","library(fastDummies)"
"2","Warning: package ‘fastDummies’ was built under R version 4.3.3"
"0","library(MASS)"
"0","library(broom)"
"0",""
"0","# load functions for data generation"
"0","Fun_datagen <- function(Fun.n = 500, Fun.y.type = c(""continuous"",""binary"",""count""), Fun.rand = c(""SR"",""CAR""), Fun.p = 2/3){"
"0","  "
"0","  # generate the covariates Xc, Xb and stratification variable Z"
"0","  df <- tibble("
"0","    Xc = runif(Fun.n), "
"0","    Xb = rbinom(Fun.n, size = 1, prob = 0.5)"
"0","  ) %>% "
"0","    mutate(Z = cut(Xc, breaks = c(0, 1/3, 2/3, 1), labels = paste0(""strata"", c(1:3))))"
"0","  "
"0","  # generate treatment assignment A by SR or CAR"
"0","  if(Fun.rand == ""SR""){"
"0","    df <- df %>% mutate(A = rbinom(n=Fun.n, size=1, prob=Fun.p))"
"0","  }else if(Fun.rand == ""CAR""){"
"0","    df$A <- RobinCar::car_pb(z = df %>% dplyr::select(Z), trt_label=c(0, 1), trt_alc=c(1-Fun.p, Fun.p), blocksize=6L)"
"0","  }"
"0","  "
"0","  # generate outcome y"
"0","  if(Fun.y.type == ""continuous""){"
"0","    df <- df %>%"
"0","      mutate(y = (1-A)*(Xc+0.1*Xb) + A*(0.3*Xc+0.3*Xb))"
"0","  }else if(Fun.y.type == ""binary""){"
"0","    df <- df %>% mutate(y = rbinom(n = Fun.n, size = 1, prob = (1-A)*(0.5*Xc+0.25*Xc^2+0.1*Xb) + A*exp(Xc+Xc^2+0.3*Xb)/(1+exp(Xc+Xc^2+0.3*Xb))))"
"0","  }else if(Fun.y.type == ""count""){"
"0","    df <- df %>% mutate(y = MASS::rnegbin(n = Fun.n, mu = A*(2*Xc+5*Xc^2+0.1*Xb) + (1-A)*log(6*Xc^3+2+0.3*Xb), theta = 4))"
"0","  }"
"0","  "
"0","  df <- df %>% mutate(A = factor(A))"
"0","  return(df)"
"0","}"
